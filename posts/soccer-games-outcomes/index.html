<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="René Valenzuela">
<meta name="dcterms.date" content="2023-07-18">

<title>Modeling the outcome of soccer games – Rene Valenzuela</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9942e89ee50bb45bf140bafd84b22ecd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Rene Valenzuela</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#model-independent-poisson-models" id="toc-model-independent-poisson-models" class="nav-link" data-scroll-target="#model-independent-poisson-models">Model: Independent Poisson models</a>
  <ul class="collapse">
  <li><a href="#high-level-approach" id="toc-high-level-approach" class="nav-link" data-scroll-target="#high-level-approach">High level approach</a></li>
  <li><a href="#hashing-out-the-details" id="toc-hashing-out-the-details" class="nav-link" data-scroll-target="#hashing-out-the-details">Hashing out the details</a>
  <ul class="collapse">
  <li><a href="#fitting-the-poisson-model" id="toc-fitting-the-poisson-model" class="nav-link" data-scroll-target="#fitting-the-poisson-model">Fitting the Poisson model</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#generating-predictions" id="toc-generating-predictions" class="nav-link" data-scroll-target="#generating-predictions">Generating predictions</a></li>
  </ul></li>
  <li><a href="#model-random-forest-of-home-and-away-goal-rates" id="toc-model-random-forest-of-home-and-away-goal-rates" class="nav-link" data-scroll-target="#model-random-forest-of-home-and-away-goal-rates">Model: Random forest of home and away goal rates</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling the outcome of soccer games</h1>
  <div class="quarto-categories">
    <div class="quarto-category">predictive-modeling</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>René Valenzuela </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 18, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 26, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<!--
TODO:
- Why are some duplicates in games_to_predict_all_res?
- Add a scatter plot of hma10 versus ama10 ... label by result
-->
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Our goal is to create a model to predict the outcome of La Liga games</p>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>The original dataset consists of the results of each of the games played during the 2021-2022 and 2022-2023 seasons. A sample is shown in <a href="#tbl-raw" class="quarto-xref">Table&nbsp;1</a>,</p>
<div class="cell" data-execution_count="4">
<div id="tbl-raw" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Input dataset. Results of the 21-22 La Liga season
</figcaption>
<div aria-describedby="tbl-raw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">at</th>
<th data-quarto-table-cell-role="th">fthg</th>
<th data-quarto-table-cell-role="th">ftag</th>
<th data-quarto-table-cell-role="th">ftr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>s_21_22</td>
<td>2021-08-13</td>
<td>20:00</td>
<td>Valencia</td>
<td>Getafe</td>
<td>1</td>
<td>0</td>
<td>H</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>18:30</td>
<td>Cadiz</td>
<td>Levante</td>
<td>1</td>
<td>1</td>
<td>D</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>18:30</td>
<td>Mallorca</td>
<td>Betis</td>
<td>1</td>
<td>1</td>
<td>D</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>21:00</td>
<td>Alaves</td>
<td>Real Madrid</td>
<td>1</td>
<td>4</td>
<td>A</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>21:00</td>
<td>Osasuna</td>
<td>Espanol</td>
<td>0</td>
<td>0</td>
<td>D</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>where <code>fthg</code> stands for full-time home team goals, <code>ftag</code> stands for full-time away team goals and <code>ftr</code> stands for full-time result which can take values <code>H</code> if the game ends in a win for the home team, <code>A</code> if the game ends in a win for the away team or <code>D</code> if the game ends in a draw.</p>
</section>
<section id="model-independent-poisson-models" class="level1">
<h1>Model: Independent Poisson models</h1>
<section id="high-level-approach" class="level2">
<h2 class="anchored" data-anchor-id="high-level-approach">High level approach</h2>
<ul>
<li>We let the two teams participating in a game be <strong>Team A</strong> and <strong>Team B</strong>.</li>
<li>We let the outcome of the game be <strong>W</strong> if the predicted result is that Team A wins, <strong>T</strong> if the game is predicted to end in a tie and <strong>L</strong> if Team A is predicted to lose the game.</li>
<li>For each team we model the number of goals scored in a game as a Poisson distribution and we fit one based on historical data.</li>
<li>We assume the number of goals scored by a team in a game is independent of the number of goals scored by the adversary and create a joint probability funcion as the product of the marginals</li>
<li>We evaluate the joint distribution on a grid of possible scores</li>
<li>We assign the game outcome as the one corresponding to the maximum probability of the game final score. That is, if the final score with highest probability is Team A: 3 and Team B: 2 then the outcome of the game will be <strong>W</strong></li>
</ul>
</section>
<section id="hashing-out-the-details" class="level2">
<h2 class="anchored" data-anchor-id="hashing-out-the-details">Hashing out the details</h2>
<section id="fitting-the-poisson-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-poisson-model">Fitting the Poisson model</h3>
<p>The probability mass function of a Poisson distributed random variable <span class="math inline">\(X\)</span> is: <span class="math display">\[
\begin{equation*}
p_{X}(k) = \mathbb{P}\text{r}\left(X = k\right) = e^{-\lambda}\frac{\lambda^{k}}{k!}
\end{equation*}
\]</span></p>
<p>Given a sample of <span class="math inline">\(n\)</span> realizations of the random variable the MLE of <span class="math inline">\(\lambda\)</span> is simply the sample mean, i.e., <span class="math display">\[
\tilde{\lambda}_{MLE} = \frac{1}{n}\sum_{i=1}^{n} x_{i}
\]</span></p>
<p>To fit the Poisson r.v. we must define a sample from which the <span class="math inline">\(\lambda\)</span> parameter will be estimated. The simplest possible approach is to use as a sample the results of the last <span class="math inline">\(N\)</span> games where <span class="math inline">\(N\)</span> is a fixed number. As a starting point we will choose <span class="math inline">\(N = 10\)</span>. Since some teams play more than one La Liga game a week 10 games roughly corresponds to a 2 month historic period.</p>
<p>We will fit a Poisson model for each team and for each week (i.e.&nbsp;after a game we will update the model). The implementation is done using a moving average rolling window of the 10 last games of each team.</p>
</section>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<p>Starting from the original dataset we construct the input dataset for model fitting. In this dataset we keep for each team the number of goals they scored and make sure we order them in the order of occurrence. A sample is shown in <a href="#tbl-results-alaves" class="quarto-xref">Table&nbsp;2</a>,</p>
<div class="cell" data-execution_count="9">
<div id="tbl-results-alaves" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="9">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-results-alaves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Results for the first twelve games of Alaves during the 2021-2022 season
</figcaption>
<div aria-describedby="tbl-results-alaves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">goals</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>21:00</td>
<td>Alaves</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>s_21_22</td>
<td>2021-08-21</td>
<td>16:00</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>s_21_22</td>
<td>2021-08-27</td>
<td>21:15</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>s_21_22</td>
<td>2021-09-18</td>
<td>20:00</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>s_21_22</td>
<td>2021-09-22</td>
<td>18:30</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>s_21_22</td>
<td>2021-09-25</td>
<td>13:00</td>
<td>Alaves</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>s_21_22</td>
<td>2021-10-01</td>
<td>20:00</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>s_21_22</td>
<td>2021-10-18</td>
<td>18:00</td>
<td>Alaves</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>s_21_22</td>
<td>2021-10-23</td>
<td>15:15</td>
<td>Alaves</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>s_21_22</td>
<td>2021-10-26</td>
<td>18:00</td>
<td>Alaves</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>s_21_22</td>
<td>2021-10-30</td>
<td>20:00</td>
<td>Alaves</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>s_21_22</td>
<td>2021-11-06</td>
<td>17:30</td>
<td>Alaves</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>As a check, we verify the number of games each team has played during the course of two seasons. In La Liga, 20 teams play 38 games each during the course of the season. At the end of the season 3 teams are relegated to the second division and 3 are promoted. Hence, over the course of two seasons there should be 17 teams that played both seasons and 6 teams that only played one season. The result of this count is shown in <a href="#tbl-games-played" class="quarto-xref">Table&nbsp;3</a></p>
<div class="cell" data-execution_count="10">
<div id="tbl-games-played" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="10">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-games-played-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Count of total games played by teams over two seasons
</figcaption>
<div aria-describedby="tbl-games-played-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_games</th>
<th data-quarto-table-cell-role="th">team</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>38</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>76</td>
<td>17</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>Model fitting consists in calculating for each team we the rolling mean over a period of previous 10 games. We have to ensure that the result of the current game is not used rolling mean calculation (if we didn’t we would have data leakage). The first estimate for the rolling mean will be for the 11th game. A sample of the model fitting results is shown in <a href="#tbl-fit-alaves" class="quarto-xref">Table&nbsp;4</a></p>
<div class="cell" data-execution_count="12">
<div id="tbl-fit-alaves" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="12">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-fit-alaves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Model fitting for the first twelve games of Alaves during the 2021-2022 season
</figcaption>
<div aria-describedby="tbl-fit-alaves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">season</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">team</th>
<th data-quarto-table-cell-role="th">goals</th>
<th data-quarto-table-cell-role="th">ma10</th>
<th data-quarto-table-cell-role="th">games_played</th>
<th data-quarto-table-cell-role="th">season_game</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>s_21_22</td>
<td>2021-08-14</td>
<td>21:00</td>
<td>Alaves</td>
<td>1</td>
<td>NaN</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>s_21_22</td>
<td>2021-08-21</td>
<td>16:00</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>s_21_22</td>
<td>2021-08-27</td>
<td>21:15</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>s_21_22</td>
<td>2021-09-18</td>
<td>20:00</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>s_21_22</td>
<td>2021-09-22</td>
<td>18:30</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>4</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>s_21_22</td>
<td>2021-09-25</td>
<td>13:00</td>
<td>Alaves</td>
<td>1</td>
<td>NaN</td>
<td>5</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>s_21_22</td>
<td>2021-10-01</td>
<td>20:00</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>6</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>s_21_22</td>
<td>2021-10-18</td>
<td>18:00</td>
<td>Alaves</td>
<td>0</td>
<td>NaN</td>
<td>7</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>s_21_22</td>
<td>2021-10-23</td>
<td>15:15</td>
<td>Alaves</td>
<td>2</td>
<td>NaN</td>
<td>8</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>s_21_22</td>
<td>2021-10-26</td>
<td>18:00</td>
<td>Alaves</td>
<td>1</td>
<td>NaN</td>
<td>9</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>s_21_22</td>
<td>2021-10-30</td>
<td>20:00</td>
<td>Alaves</td>
<td>1</td>
<td>0.5</td>
<td>10</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>s_21_22</td>
<td>2021-11-06</td>
<td>17:30</td>
<td>Alaves</td>
<td>2</td>
<td>0.5</td>
<td>11</td>
<td>12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>The ovarall results of model fitting can be visualized in <a href="#fig-ind-poisson-fit" class="quarto-xref">Figure&nbsp;1</a>, a heatmap of the rate parameter for each team and for each week.</p>
<div id="cell-fig-ind-poisson-fit" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div id="fig-ind-poisson-fit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ind-poisson-fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-ind-poisson-fit-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ind-poisson-fit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Heatmap of rate parameter by team and season game
</figcaption>
</figure>
</div>
</div>
</div>
<p>The teams are ordered by rows with the team that finished in the first place in the first row and so on. Each square on the grid is colored according to the value of the fitted rate parameter and the columns represent the number of games played, i.e.&nbsp;the column labeled <code>11</code> represents the eleventh game of each team. This will almost always correspond to the week of the season. Also, note that the first game for which we have a parameter is the eleventh game of each team since we chose an 10 games window for teh moving average</p>
<p>Teams in the top rows have a higher rate parameter and also some teams that went on a scoring streak during the season. Amongst them we have Villareal at the start of the second leg and Levante at the end of the season.</p>
</section>
<section id="generating-predictions" class="level2">
<h2 class="anchored" data-anchor-id="generating-predictions">Generating predictions</h2>
<p>To generate predictions we first attach the estimated rate parameters of the home team and of the away team for each game played in the season:</p>
<div id="0ed7a64d" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">at</th>
<th data-quarto-table-cell-role="th">ftr</th>
<th data-quarto-table-cell-role="th">hma10</th>
<th data-quarto-table-cell-role="th">ama10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Valencia</td>
<td>Getafe</td>
<td>H</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Cadiz</td>
<td>Levante</td>
<td>D</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Mallorca</td>
<td>Betis</td>
<td>D</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Alaves</td>
<td>Real Madrid</td>
<td>A</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Osasuna</td>
<td>Espanol</td>
<td>D</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We then generate (for each game) all possible results starting from 0-0 and up to 5-5, i.e.&nbsp;36 possible scores for each game and assign the corresponding probability using the Poisson mass probability function</p>
<div id="c0857af5" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ht</th>
<th data-quarto-table-cell-role="th">at</th>
<th data-quarto-table-cell-role="th">fthg</th>
<th data-quarto-table-cell-role="th">ftag</th>
<th data-quarto-table-cell-role="th">ftr</th>
<th data-quarto-table-cell-role="th">hma10</th>
<th data-quarto-table-cell-role="th">ama10</th>
<th data-quarto-table-cell-role="th">pred_hgoals</th>
<th data-quarto-table-cell-role="th">pred_agoals</th>
<th data-quarto-table-cell-role="th">h_prob</th>
<th data-quarto-table-cell-role="th">a_prob</th>
<th data-quarto-table-cell-role="th">joint_prob</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5833</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>1</td>
<td>0.367879</td>
<td>0.345236</td>
<td>0.127005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5839</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>1</td>
<td>0.367879</td>
<td>0.345236</td>
<td>0.127005</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20419</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>1</td>
<td>0.366158</td>
<td>0.345236</td>
<td>0.126411</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20413</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>1</td>
<td>0.332871</td>
<td>0.345236</td>
<td>0.114919</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5832</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>0</td>
<td>0.367879</td>
<td>0.246597</td>
<td>0.090718</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5838</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>0</td>
<td>0.367879</td>
<td>0.246597</td>
<td>0.090718</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20418</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>0</td>
<td>0.366158</td>
<td>0.246597</td>
<td>0.090293</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5834</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>2</td>
<td>0.367879</td>
<td>0.241665</td>
<td>0.088904</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5840</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>2</td>
<td>0.367879</td>
<td>0.241665</td>
<td>0.088904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20420</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>2</td>
<td>0.366158</td>
<td>0.241665</td>
<td>0.088488</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20412</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>0</td>
<td>0.332871</td>
<td>0.246597</td>
<td>0.082085</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20414</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>2</td>
<td>0.332871</td>
<td>0.241665</td>
<td>0.080443</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20425</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>2</td>
<td>1</td>
<td>0.201387</td>
<td>0.345236</td>
<td>0.069526</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5845</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>2</td>
<td>1</td>
<td>0.183940</td>
<td>0.345236</td>
<td>0.063503</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20424</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>2</td>
<td>0</td>
<td>0.201387</td>
<td>0.246597</td>
<td>0.049661</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20426</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>2</td>
<td>2</td>
<td>0.201387</td>
<td>0.241665</td>
<td>0.048668</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5844</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>2</td>
<td>0</td>
<td>0.183940</td>
<td>0.246597</td>
<td>0.045359</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5846</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>2</td>
<td>2</td>
<td>0.183940</td>
<td>0.241665</td>
<td>0.044452</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5835</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>3</td>
<td>0.367879</td>
<td>0.112777</td>
<td>0.041488</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5841</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>3</td>
<td>0.367879</td>
<td>0.112777</td>
<td>0.041488</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20421</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>3</td>
<td>0.366158</td>
<td>0.112777</td>
<td>0.041294</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20415</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>3</td>
<td>0.332871</td>
<td>0.112777</td>
<td>0.037540</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20431</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>3</td>
<td>1</td>
<td>0.073842</td>
<td>0.345236</td>
<td>0.025493</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20427</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>2</td>
<td>3</td>
<td>0.201387</td>
<td>0.112777</td>
<td>0.022712</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5851</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>3</td>
<td>1</td>
<td>0.061313</td>
<td>0.345236</td>
<td>0.021168</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5847</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>2</td>
<td>3</td>
<td>0.183940</td>
<td>0.112777</td>
<td>0.020744</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20430</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>3</td>
<td>0</td>
<td>0.073842</td>
<td>0.246597</td>
<td>0.018209</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20432</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>3</td>
<td>2</td>
<td>0.073842</td>
<td>0.241665</td>
<td>0.017845</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5850</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>3</td>
<td>0</td>
<td>0.061313</td>
<td>0.246597</td>
<td>0.015120</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5852</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>3</td>
<td>2</td>
<td>0.061313</td>
<td>0.241665</td>
<td>0.014817</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5836</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>4</td>
<td>0.367879</td>
<td>0.039472</td>
<td>0.014521</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5842</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>4</td>
<td>0.367879</td>
<td>0.039472</td>
<td>0.014521</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20422</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>4</td>
<td>0.366158</td>
<td>0.039472</td>
<td>0.014453</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20416</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>4</td>
<td>0.332871</td>
<td>0.039472</td>
<td>0.013139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20433</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>3</td>
<td>3</td>
<td>0.073842</td>
<td>0.112777</td>
<td>0.008328</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20428</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>2</td>
<td>4</td>
<td>0.201387</td>
<td>0.039472</td>
<td>0.007949</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5848</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>2</td>
<td>4</td>
<td>0.183940</td>
<td>0.039472</td>
<td>0.007260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20437</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>4</td>
<td>1</td>
<td>0.020307</td>
<td>0.345236</td>
<td>0.007011</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5853</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>3</td>
<td>3</td>
<td>0.061313</td>
<td>0.112777</td>
<td>0.006915</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5857</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>4</td>
<td>1</td>
<td>0.015328</td>
<td>0.345236</td>
<td>0.005292</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20436</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>4</td>
<td>0</td>
<td>0.020307</td>
<td>0.246597</td>
<td>0.005008</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20438</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>4</td>
<td>2</td>
<td>0.020307</td>
<td>0.241665</td>
<td>0.004907</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5837</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>0</td>
<td>5</td>
<td>0.367879</td>
<td>0.011052</td>
<td>0.004066</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5843</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>1</td>
<td>5</td>
<td>0.367879</td>
<td>0.011052</td>
<td>0.004066</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20423</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>1</td>
<td>5</td>
<td>0.366158</td>
<td>0.011052</td>
<td>0.004047</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5856</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>4</td>
<td>0</td>
<td>0.015328</td>
<td>0.246597</td>
<td>0.003780</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5858</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>4</td>
<td>2</td>
<td>0.015328</td>
<td>0.241665</td>
<td>0.003704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20417</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>0</td>
<td>5</td>
<td>0.332871</td>
<td>0.011052</td>
<td>0.003679</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20434</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>0</td>
<td>1</td>
<td>A</td>
<td>1.1</td>
<td>1.4</td>
<td>3</td>
<td>4</td>
<td>0.073842</td>
<td>0.039472</td>
<td>0.002915</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5854</td>
<td>Villarreal</td>
<td>Vallecano</td>
<td>2</td>
<td>0</td>
<td>H</td>
<td>1.0</td>
<td>1.4</td>
<td>3</td>
<td>4</td>
<td>0.061313</td>
<td>0.039472</td>
<td>0.002420</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="d7b65a35" class="cell" data-execution_count="23">
<div class="cell-output cell-output-stdout">
<pre><code>The accuracy of the model is 0.3711 and the balanced accuracy is 0.3952</code></pre>
</div>
</div>
</section>
</section>
<section id="model-random-forest-of-home-and-away-goal-rates" class="level1">
<h1>Model: Random forest of home and away goal rates</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rcvalenzuela\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, René Valenzuela</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Thus website is built with <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>